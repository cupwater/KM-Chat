# AI智能搜索功能说明

## 功能概述

MrDoc的AI智能搜索功能基于本地文档和向量数据库，提供智能搜索和问答服务。该功能集成了OpenAI API和Milvus向量数据库，能够理解用户意图并提供精准的搜索结果和AI回答。

## 主要特性

### 🔍 智能搜索
- **意图识别**：自动识别搜索意图（关键词搜索 vs 问题查询）
- **向量搜索**：基于文档内容的语义搜索
- **智能回答**：根据搜索结果生成AI回答
- **搜索建议**：实时提供搜索建议

### 📚 侧边栏历史记录
- **自动保存**：每次搜索自动保存到本地存储
- **时间过滤**：支持全部、今天、本周过滤
- **快速重搜**：点击历史记录重新搜索
- **记录管理**：删除单个记录或清空所有历史
- **智能去重**：相同查询自动更新而不是重复添加
- **响应式设计**：移动端自动适配

### 🤖 AI问答
- **直接提问**：支持自然语言问题
- **文档问答**：针对特定文档提问
- **上下文理解**：基于相关文档生成回答
- **引用标注**：显示回答来源文档

## 页面功能

### 搜索界面
- **搜索输入框**：支持关键词和自然语言查询
- **实时建议**：输入时显示搜索建议
- **服务状态**：实时显示OpenAI和向量服务状态
- **加载动画**：搜索过程中的视觉反馈

### 侧边栏功能
- **历史记录列表**：显示所有搜索历史
- **过滤按钮**：全部、今天、本周、清空
- **记录详情**：显示查询内容、时间、结果数量
- **操作按钮**：删除单个记录
- **空状态**：无历史记录时的友好提示

### 搜索结果
- **AI回答**：智能生成的回答内容
- **搜索摘要**：搜索结果概览
- **文档列表**：相关文档展示
- **引用标注**：标记被引用的文档
- **操作按钮**：查看文档、询问文档

## 技术架构

### 后端服务
- **AISearchService**：核心搜索服务类
- **意图识别**：区分搜索类型
- **向量搜索**：Milvus向量数据库查询
- **AI生成**：OpenAI API调用
- **结果处理**：数据格式化和优化

### 前端界面
- **响应式设计**：适配各种设备
- **现代化UI**：渐变背景、阴影效果
- **交互体验**：悬停动画、加载状态
- **本地存储**：浏览器localStorage持久化

### API接口
- **POST /vector/api/ai-search/**：智能搜索
- **POST /vector/api/ai-search/ask/**：直接提问
- **GET /vector/api/ai-search/suggestions/**：搜索建议
- **GET /vector/api/ai-search/status/**：服务状态

## 配置说明

### 环境变量
```bash
# OpenAI配置
OPENAI_API_KEY=your_openai_api_key
OPENAI_BASE_URL=https://api.openai.com/v1

# Milvus配置
MILVUS_HOST=localhost
MILVUS_PORT=19530
MILVUS_COLLECTION_NAME=mrdoc_vectors
```

### 配置文件
```ini
[ai_search]
# OpenAI设置
openai_api_key = your_api_key_here
openai_base_url = https://api.openai.com/v1
openai_model = gpt-3.5-turbo
openai_max_tokens = 1000
openai_temperature = 0.7

# 向量搜索设置
vector_top_k = 10
vector_score_threshold = 0.5

# 搜索设置
search_max_results = 20
search_timeout = 30
```

## 使用指南

### 基本搜索
1. 访问AI搜索页面
2. 在搜索框输入关键词或问题
3. 点击搜索按钮或按回车
4. 查看AI回答和相关文档

### 历史记录管理
1. **查看历史**：侧边栏自动显示搜索历史
2. **过滤记录**：使用全部/今天/本周按钮
3. **重新搜索**：点击历史记录项
4. **删除记录**：悬停显示删除按钮
5. **清空历史**：点击清空按钮确认删除

### 高级功能
1. **直接提问**：使用自然语言提问
2. **文档问答**：点击"询问此文档"按钮
3. **搜索建议**：输入时查看建议选项
4. **服务监控**：右上角查看服务状态

## 开发说明

### 添加新功能
1. 在`AISearchService`中添加新方法
2. 在`views.py`中添加API接口
3. 在`urls.py`中注册路由
4. 在前端页面中添加UI元素

### 自定义样式
- 修改CSS变量调整主题色
- 调整响应式断点适配设备
- 自定义动画效果和交互

### 扩展搜索
- 添加更多搜索类型
- 集成其他AI模型
- 支持多语言搜索
- 添加搜索过滤器

## 故障排除

### 常见问题
1. **搜索无结果**：检查向量数据库是否正常
2. **AI回答失败**：验证OpenAI API配置
3. **历史记录丢失**：检查浏览器localStorage
4. **页面加载慢**：优化向量搜索性能

### 调试方法
1. 查看浏览器控制台错误
2. 检查Django日志输出
3. 验证API接口响应
4. 测试服务连接状态

## 更新日志

### v1.0.0 (2024-06-26)
- ✅ 基础AI搜索功能
- ✅ 智能意图识别
- ✅ 向量文档搜索
- ✅ AI回答生成
- ✅ 搜索建议功能

### v1.1.0 (2024-06-26)
- ✅ 侧边栏历史记录
- ✅ 时间过滤功能
- ✅ 记录管理操作
- ✅ 响应式设计
- ✅ 现代化UI界面

## 贡献指南

欢迎提交Issue和Pull Request来改进AI搜索功能！

### 开发环境
```bash
# 克隆项目
git clone https://github.com/zmister2016/MrDoc.git

# 安装依赖
pip install -r requirements.txt

# 运行开发服务器
python manage.py runserver
```

### 代码规范
- 遵循PEP 8 Python代码规范
- 使用中文注释说明功能
- 添加适当的错误处理
- 编写单元测试用例

---

**注意**：使用AI搜索功能需要配置有效的OpenAI API密钥和Milvus向量数据库。 